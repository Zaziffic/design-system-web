# How to generate to valid deploy_rsa.enc file ?
#
# Generate a dedicated SSH key :
# ssh-keygen -t rsa -b 4096 -C 'build@travis-ci.org' -f ./deploy_rsa
# 
# Encrypt the private key and add $encrypted_xxx_key and $encrypted_xxx_key to the env
# travis login --org
# sous windows (gitbash):
# - travis encrypt key_password=sdfjlqdsfjdqsmlj798fds
# - gpg -c deploy_rsa
# - Then add secure env variable and "echo $key_password | gpg --passphrase-fd 0 deploy_rsa.gpg" to the defore-reploy
# sous Linux : 
# - travis encrypt-file deploy_rsa -p --add
#   (auto add the line openssl aes-256-cbc -K $encrypted_d68160cf0aa5_key -iv $encrypted_d68160cf0aa5_iv -in deploy_rsa.enc -out deploy_rsa -d)
# 
# Copy the public key onto the remote SSH server
# ssh-copy-id -i deploy_rsa.pub loireatl-ds@ssh.cluster011.hosting.ovh.net
# ssh-copy-id -i deploy_rsa.pub loireatl-devds@ssh.cluster011.hosting.ovh.net
# 
# Remove the key from your computer
# rm -f deploy_rsa deploy_rsa.pub
# 
# Add the key to github
# git add deploy_rsa.enc
# 
env:
  global:
    secure: "CUodewXD3rxjk246jtq7ku25QjzGXcOAuuDaSBcU7yhNNarvXhR+cx9cgjkTViX+1H0fgy9Hi4NITj3823VCZzGn3UCQrbQvQIkIUE8qkV2SDIfd8G/c9Usi3zCQNl4RPY+rd+cgEfb3UJ+xGUOLDTeQl7F5LniDmUCRNctZteXPYpDWq5hR6vyBlV+IywnuDNEbLdDiItn3+i4Ggne2mx86GEBWPsaMpyryyySsmfW/pmYCP7Dj1WTbl4gHQZqlUEZMrPubeM2pbWWm7ZoO0VSA5jYMy6v67TKd8EehyUm3yXjNJje25CfQwvKhJRqBKdM0IaCx3LsJWUWzJhKgD2ZVe2MJCAG0o0S2k7eJzMIEAV4rRrrD3IlEve7heVis/Ner9lrKU6nHm75OSsKbNKa3VGPbnoeKVhXZGF0OWnOXAFrn4ipy1/bGG7O5SPSXTHJsIAHPg+tefiXdE35HZXItaG2hNtb0Na+1SNwxiC0iDt4bq/8aebQZNQXMNF8iaLjuPcM1xZYj1A5maBFEdaxVjdxJyebWwpAO7aR740h/KfuT1bP5QPauyUusSB+wFOUBtx+fn/FmkiKEgb6fyln5E5GBfPXMc5ZvTBm+p3HNjsjexR1t3/I2vHnoEokvEC5aFp2ZTVDK1LdImsUqTSfdqLx+cLohc9pEKSWIAS0="

addons:
  ssh_known_hosts: ssh.cluster011.hosting.ovh.net
  
before_script:
  - npm install -g gulp-cli
  - npm install

script: 
  - gulp build

# Unlock private key
before_deploy:
  - echo $key_password | gpg --passphrase-fd 0 deploy_rsa.gpg
  - eval "$(ssh-agent -s)"
  - chmod 600 deploy_rsa
  - ssh-add deploy_rsa

deploy:
  - provider: script
    skip_cleanup: true
    script: rsync -r --delete-after --quiet --exclude .ssh $TRAVIS_BUILD_DIR/dist/ loireatl-ds@ssh.cluster011.hosting.ovh.net:/home/loireatl-ds/
    on:
      branch: master
  - provider: script
    skip_cleanup: true
    script: rsync -r --delete-after --quiet --exclude .ssh $TRAVIS_BUILD_DIR/dist/ loireatl-devds@ssh.cluster011.hosting.ovh.net:/home/loireatl-devds/
    on:
      branch: recette